<!DOCTYPE html>
<html>
<head>
	<title>千星娱乐（夺宝）</title>
	<meta http-equiv="Pragma" content="no-cache">
	<meta http-equiv="Cache-Control" content="no-cache">
	<meta http-equiv="Expires" content="0">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.0, user-scalable=no"/>
	<script type="text/javascript" src="/static/js/flexible_css.js"></script>
	<script type="text/javascript" src="/static/js/flexible.js"></script>
	<link rel="stylesheet" type="text/css" href="/static/css/fish.css">
	<!-- <link rel="stylesheet" type="text/css" href="/static/css/game.css"> -->
</head>
<body>
<div class="h_bg">
	<!-- top -->
	<div class="h-top clearfix">
		<div class="h-id">12345</div>
		<div class="h-money">12345</div>
		<div class="h-rule">
			<img src="/static/img/rule.png">
		</div>
	</div>
	<!-- 中奖消息 -->
	<div class="h-info">
		<div class="result-message">
			<p>ID:12321 恭喜得到喵币30.00，继续努力哟！~~</p>
			<p>ID:12321 恭喜得到喵币30.00，继续努力哟！~~</p>
			<p>ID:12321 恭喜得到喵币30.00，继续努力哟！~~</p>
		</div>
	</div>

	<!-- 捕鱼情况 -->
	<div class="befind">
       <div class="fish-i-1 fish-a swim">
         <div class="hongbao">6</div>
       </div>
       <div class="fish-i-1 fish-b swim">
         <div class="hongbao">10</div>
       </div>
       <div class="fish-i-1 fish-c swim">
         <div class="hongbao">15</div>
       </div>
       <div class="fish-i-1 fish-d swim">
         <div class="hongbao">20</div>
       </div>
       <div class="fish-i-1 fish-e swim">
         <div class="hongbao">？</div>
       </div>
   	</div>
	<div class="panel">
       <div class="fish-i fish-a swimming"  data-val="6">
         <div class="floater"></div>
         <div class="hongbao">6</div>
       </div>
       <div class="fish-i fish-b swimming"  data-val="10">
         <div class="floater"></div>
         <div class="hongbao">10</div>
       </div>
       <div class="fish-i fish-c swimming"  data-val="15">
         <div class="floater"></div>
         <div class="hongbao">15</div>
       </div>
       <div class="fish-i fish-d swimming"  data-val="20">
         <div class="floater"></div>
         <div class="hongbao">20</div>
       </div>
       <div class="fish-i fish-e swimming"  data-val="？">
         <div class="floater"></div>
         <div class="hongbao">？</div>
       </div>
   	</div>
	<!-- 中间部分 -->
	<div class="h-center clearfix">
		<div class="h-left">
			<ul class="h-btn-list low-num">
				<li a="20">
					<img class="img-20" src="/static/img/20.png">
				</li>
				<li a="10">
					<img class="img-10" src="/static/img/10.png">
				</li>
				<li a="5" class="h-active">
					<img class="img-5" src="/static/img/5b.png">
				</li>
			</ul>

			<ul class="h-btn-list high-num">
				<li a="200">
					<img class="img-200" src="/static/img/200x.png">
				</li>
				<li a="100">
					<img class="img-100" src="/static/img/100x.png">
				</li>
				<li a="50" class="h-active">
					<img class="img-50" src="/static/img/50x1.png">
				</li>
			</ul>
		</div>
		<div class="h-right">
			<div class="h-btn"></div>
			<div class="low-btn"></div>
			<div class="emit-btn" id="start"></div>
		</div>
	</div>
	<!-- 炮台部分 -->
	<div class="emplacement clearfix">
		<div class="emp-reduce"></div>
		<div class="emp-center">
			<div class="bullet" id="bullet">
				<!-- <img src="/static/img/bullet.png"> -->
			</div>
			<div class="paotai2">
				<img src="/static/img/5.png">
			</div>
			<div class="paotai1"></div>
		</div>
		<div class="emp-add"></div>
	</div>
	<!-- back -->
	<div class="h-back">返回主页</div>

	<!-- 游戏规则 -->
	<div class="fish-rule">
		<div class="inner-fish-rule">
			<div class="fish-rule-info">
				<img src="/static/img/fish_info.png">
			</div>
			<div class="fish-rule-close">
				<img src="/static/img/close.png">
			</div>
		</div>
	</div>

	<!-- 中奖结果 -->
	<div class="fish-result">
		<div class="inner-fish-result">
			<div class="result-pic">
				<p class="result-num">15</p>
				<div class="result-btn" id="resultCommit"></div>
			</div>
		</div>
	</div>

	<!-- 充值 -->
	<div class="pay">
		<div class="inner-pay">
			<div class="pay-bg">
				<div class="pay-close">
					<img src="/static/img/close.png">
				</div>
				<ul class="pay-list clearfix">
					<li class="pay-active">25.00</li>
					<li>50.00</li>
					<li>100.00</li>
					<li>300.00</li>
					<li>500.00</li>
					<li>800.00</li>
					<li>1000.00</li>
					<li>3000.00</li>
					<li>5000.00</li>
				</ul>
				<div class="weixin-pay">
					<img src="/static/img/weixin_pay.png">
				</div>
				<div class="ali-pay">
					<img src="/static/img/ali_pay.png">
				</div>
				<div class="person-pay">
					<img src="/static/img/person_pay.png">
				</div>
			</div>
		</div>
	</div>

</div>
<script type="text/javascript" src="/static/js/jquery.js"></script>
<script type="text/javascript" src="/static/js/fish.js"></script>
<script type="text/javascript" src="/static/js/game.js"></script>
 <script>
        // mobile rem (540px)
        // 游戏不使用rem -> 转为全局缩放
        // document.querySelector('html').style.fontSize = '54px'
        // window.addEventListener('load', () => {
        //     var w = window.innerWidth
        //     if (w > 640) w = 640
        //     document.querySelector('html').style.fontSize = w / 10 + 'px'
        // })
       // var s =  window.innerWidth / 540
       // document.querySelector('meta[name=viewport]').setAttribute('content', 'width=device-width, initial-scale=' + s + ', user-scalable=no')
			$(function(){
				var fishes = [].slice.call(document.querySelectorAll('.fish-i'))
        var bullet = document.querySelector('#bullet')
        var fishResult = document.querySelector('.fish-result')
        var resultNum = document.querySelector('.result-num')
				var resultCommit = document.querySelector('#resultCommit')
				var shot = document.querySelector('#start')

        var game = new Game('.panel', fishes, bullet, (target) => {
            // 击中后的函数 target为击中的dom
            // alert('[中奖了哦]: ' + target.dataset.val)
            console.log(target)
						console.log(target.dataset.val)
						let value = target.dataset.val == '?' ? 0 : target.dataset.val;
						$.ajax({
							url:"/gm/catch_fish.do",
							method:"post",
							data:{
								catch_num:value,
								guess_num: attr_a,
							},
							success:function(data){
								if(data.success){
									$('.h-money').text(data.money) //金币余额
									$('.result-num').text(data.money) //中奖结果
								}
								else
								{
									var msg = data.msg;
								}

							}
						})
            let val = target.dataset.val;
            fishResult.style.display="block";
            resultNum.innerHTML = val;
            resultNum.style.color = 'red';
        })
        
        resultCommit.addEventListener('click',function(){
        	fishResult.style.display="none";
        	game.reset()
        })
        
				shot.addEventListener("touchstart",function(){
					document.querySelector('.paotai2').style.transform = 'scaleY(.8)'
					document.querySelector('.paotai2').style.animationDuration = '2s'
				})
        shot.addEventListener('touchend', function () {
						game.start()
						document.querySelector('.paotai2').style.transform = 'scaleY(1)'
				})
				// shot.addEventListener('click', function () {
        //     game.start()
				// })


				//普通场按钮切换
				var attr_a = 5;
				$(".low-num li").click(function(){
					$(".low-num li").removeClass('h-active')
					$(this).addClass('h-active')
					attr_a = $(this).attr('a');
					if(attr_a==20){
						$(this).find('img').attr('src','./img/20b.png')
						$(".low-num li").find('.img-10').attr('src','./img/10.png')
						$(".low-num li").find('.img-5').attr('src','./img/5.png')
					}

					if(attr_a==10){
						$(this).find('img').attr('src','./img/10b.png')
						$(".low-num li").find('.img-20').attr('src','./img/20.png')
						$(".low-num li").find('.img-5').attr('src','./img/5.png')
					}

					if(attr_a==5){
						$(this).find('img').attr('src','./img/5b.png')
						$(".low-num li").find('.img-20').attr('src','./img/20.png')
						$(".low-num li").find('.img-10').attr('src','./img/10.png')
					}

					$('.paotai2').find('img').attr('src','./img/'+attr_a+'.png')
				})

				//高倍场按钮切换
				$(".high-num li").click(function(){
					$(".high-num li").removeClass('h-active')
					$(this).addClass('h-active')
					let attr_a = $(this).attr('a');

					if(attr_a==200){
						$(this).find('img').attr('src','./img/200x1.png')
						$(".high-num li").find('.img-100').attr('src','./img/100x.png')
						$(".high-num li").find('.img-50').attr('src','./img/50x.png')
					}

					if(attr_a==100){
						$(this).find('img').attr('src','./img/100x1.png')
						$(".high-num li").find('.img-200').attr('src','./img/200x.png')
						$(".high-num li").find('.img-50').attr('src','./img/50x.png')
					}

					if(attr_a==50){
						$(this).find('img').attr('src','./img/50x1.png')
						$(".high-num li").find('.img-200').attr('src','./img/200x.png')
						$(".high-num li").find('.img-100').attr('src','./img/100x.png')
					}

					$('.paotai2').find('img').attr('src','./img/'+attr_a+'x.png')

				})

			})
        
				

    </script>
</body>
</html>